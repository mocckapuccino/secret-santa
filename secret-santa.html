<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸ„ Secret Santa</title>

<style>
body {
    background: #0b1020;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 30px;
}
textarea {
    width: 300px;
    height: 160px;
    font-size: 16px;
    padding: 10px;
}
button {
    margin-top: 15px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
}
.link {
    background: #020617;
    padding: 10px;
    border-radius: 8px;
    margin: 10px auto;
    word-break: break-all;
    max-width: 600px;
}
.hidden {
    display: none;
}
</style>
</head>

<body>

<h1>ğŸ… Secret Santa</h1>

<div id="setup">
<p>Un prÃ©nom par ligne :</p>
<textarea id="names"></textarea><br>
<button onclick="generate()">ğŸ GÃ©nÃ©rer les liens</button>
</div>

<div id="links" class="hidden"></div>
<div id="result" class="hidden"></div>

<script>
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function encode(data) {
    return btoa(unescape(encodeURIComponent(JSON.stringify(data))));
}

function decode(data) {
    return JSON.parse(decodeURIComponent(escape(atob(data))));
}

function generate() {
    const input = document.getElementById("names").value;
    const names = input.split(/\r?\n/).map(n => n.trim()).filter(n => n);

    if (names.length < 2) {
        alert("Il faut au moins 2 participants");
        return;
    }

    let receivers = [...names];
    do {
        shuffle(receivers);
    } while (names.some((n, i) => n === receivers[i]));

    const linksDiv = document.getElementById("links");
    linksDiv.innerHTML = "<h2>ğŸ“ Liens Ã  envoyer</h2>";

    names.forEach((name, i) => {
        const payload = encode({
            giver: name,
            receiver: receivers[i]
        });

        const link = `${location.origin}${location.pathname}?data=${payload}`;

        linksDiv.innerHTML += `
            <div class="link">
                <strong>${name}</strong><br>
                <a href="${link}" target="_blank">${link}</a>
            </div>
        `;
    });

    document.getElementById("setup").classList.add("hidden");
    linksDiv.classList.remove("hidden");
}

function showResult() {
    const params = new URLSearchParams(window.location.search);
    const data = params.get("data");
    if (!data) return;

    const info = decode(data);

    document.getElementById("setup").classList.add("hidden");
    document.getElementById("links").classList.add("hidden");

    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = `
        <h2>ğŸ„ Ton Secret Santa</h2>
        <p>Tu dois offrir un cadeau Ã  :</p>
        <h1>${info.receiver}</h1>
        <p>ğŸ¤« Garde-le secret !</p>
    `;
    resultDiv.classList.remove("hidden");
}

showResult();
</script>

</body>
</html>
